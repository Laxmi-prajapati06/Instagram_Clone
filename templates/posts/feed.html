{% extends 'base.html' %}
{% load static %}

{% block title %}Instagram - Feed{% endblock %}


{% block content %}
<div class="feed-container">
    <div class="feed-grid">
        <div class="feed-main">
            {% if posts %}
                {% for post in posts %}
                <div class="post">
                    <div class="post-header">
                        <a href="{% url 'profile' post.user.id %}" style="display:flex; align-items:center; gap:12px; text-decoration:none; color:inherit;">
                            <div class="post-img">{% if post.user.profile_picture %}<img src="{{ post.user.profile_picture.url }}" style="width:100%; height:100%; object-fit:cover">{% else %}{{ post.user.username|first|upper }}{% endif %}</div>
                            <div class="post-info"><h3>{{ post.user.username }}</h3><div style="font-size:12px; color:#8a8a8a;">{{ post.created_at|timesince }} ago</div></div>
                        </a>
                    </div>

                    {% if post.image %}
                        <img src="{{ post.image.url }}" alt="Post" class="post-image" onerror="this.src='https://via.placeholder.com/600x600?text=Image+Not+Found'">
                    {% else %}
                        <div style="height:360px; display:flex; align-items:center; justify-content:center; background:#f0f0f0; color:#8a8a8a;">No image</div>
                    {% endif %}

                    <div class="post-actions">
                        <form method="post" action="{% url 'toggle_like' post.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" style="background:none;border:none; font-size:20px; cursor:pointer;">{% if post.user_has_liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</button>
                        </form>
                        <button style="background:none;border:none;font-size:20px;">Comment</button>
                    </div>

                    <div class="post-stats">{{ post.likes_count }} like{{ post.likes_count|pluralize }}</div>
                    <div class="post-caption"><strong>{{ post.user.username }}</strong> {{ post.caption }}</div>

                    {% if post.comments_list %}
                    <div style="padding:0 14px;">
                        {% for comment in post.comments_list %}
                        <div style="margin-top:8px;"><strong>{{ comment.user.username }}</strong> {{ comment.text }}</div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <form method="post" action="{% url 'add_comment' post.id %}" class="comment-form">
                        {% csrf_token %}
                        <input type="text" name="text" placeholder="Add a comment..." style="flex:1; border:none; border-bottom:1px solid #efefef; padding:6px 8px;">
                        <button type="submit" style="background:none;border:none;color:#0095f6;font-weight:600;">Post</button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <div style="text-align:center; padding:40px; background:white; border-radius:8px;">No posts yet</div>
            {% endif %}
        </div>

        <div class="feed-sidebar">
            {% if suggested_users %}
            <div class="sidebar-card">
                <div class="sidebar-header">
                    <h3>Suggestions For You</h3>
                </div>
                {% for user in suggested_users %}
                <div class="suggested-user">
                    <a href="{% url 'profile' user.id %}" style="text-decoration: none;">
                        <div class="user-info">
                            <div class="user-avatar" style="width: 60px;">
                                {% if user.profile_picture %}
                                    <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}", style="width:100%; height:100%; object-fit:cover;">
                                {% else %}
                                    {{ user.username|first|upper }}
                                {% endif %}
                            </div>
                            <div class="user-details">
                                <div class="user-name">{{ user.username }}</div>
                                <div class="user-status">Suggested for you</div>
                            </div>
                        </div>
                    </a>
                    <form method="post" action="{% url 'toggle_follow' user.id %}" style="display: inline; margin: 0;">
                        {% csrf_token %}
                        <button type="submit" class="follow-btn">Follow</button>
                    </form>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}